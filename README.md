# 图生视频 QT 客户端

基于 PyQt5 的桌面客户端应用，调用阿里云 DashScope API 实现图片转视频功能。

## 功能特点

- 📁 **工程管理**：类似 VSCode 的项目管理,支持创建和打开本地工程
- 🗂️ **资源管理器**：可视化管理工程文件,自动组织输入/输出文件
- 🖼️ **图片浏览**：内置图片查看器，支持缩放、拖动、快捷键操作
- 🎬 **视频播放**：双击视频文件即可播放
- 🔄 **拖拽支持**：
  - 从资源管理器拖拽图片到上传区域
  - 从外部拖拽文件到资源管理器导入
  - 从外部拖拽图片到上传区域
- 📸 拖拽上传本地图片
- 🎥 图片转视频生成
- ⏱️ 实时任务进度监控
- 📥 视频预览与下载
- 📋 历史任务管理
- 💬 自定义提示词配置
- 🎛️ 多模型、多分辨率支持

## 环境要求

- Python 3.7+
- PyQt5 5.15+
- 阿里云 DashScope API 密钥

## 安装步骤

1. 进入 qt_client 目录：
   ```bash
   cd qt_client
   ```

2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

3. 运行应用：
   ```bash
   python main.py
   ```

4. 在应用界面中配置 API 密钥：
   - 点击右上角的 "⚙ 设置" 按钮
   - 或使用菜单 "文件" -> "设置"
   - 输入你的阿里云 DashScope API 密钥
   - 点击保存

## 项目结构

```
qt_client/
├── main.py              # 应用入口
├── requirements.txt     # 依赖列表
├── .env.example         # 环境变量示例
├── README.md            # 项目说明
├── config/              # 配置管理
│   └── settings.py      # 配置加载
├── core/                # 核心业务逻辑
│   ├── api_client.py    # API 客户端
│   ├── task_manager.py  # 任务管理器
│   ├── project_manager.py  # 工程管理器
│   └── models.py        # 数据模型
├── ui/                  # 界面模块
│   ├── main_window.py   # 主窗口
│   ├── upload_widget.py # 上传组件
│   ├── config_panel.py  # 配置面板
│   ├── task_list.py     # 任务列表
│   ├── settings_dialog.py  # 设置对话框
│   ├── welcome_page.py  # 欢迎页面
│   ├── project_explorer.py  # 工程资源管理器
│   ├── project_dialog.py    # 工程对话框
│   └── video_player.py  # 视频播放器
└── utils/               # 工具函数
    ├── file_handler.py  # 文件处理
    └── helpers.py       # 辅助函数
```

## 使用方法

### 首次使用

1. **配置 API 密钥**
   - 启动应用后会提示配置 API 密钥
   - 点击 "是" 打开设置对话框
   - 输入你的阿里云 DashScope API 密钥
   - 点击 "保存"

2. **创建工程**
   - 在欢迎页面点击 "新建工程" 或使用菜单 "文件" -> "新建工程"
   - 输入工程名称和选择保存位置
   - 可选填写工程描述
   - 点击 "创建"

3. **生成视频**
   - 在左侧资源管理器查看工程文件结构
   - 拖拽图片到上传区域或点击选择
   - 配置参数：设置提示词、模型、分辨率等
   - 点击生成按钮
   - 图片会自动保存到工程的 `inputs` 文件夹
   - 生成的视频会保存到工程的 `outputs` 文件夹

4. **查看进度**
   - 实时监控任务状态
   - 任务完成后可在资源管理器中查看生成的视频
   - 点击视频文件可以预览

### 工程管理

#### 工程结构
每个工程包含以下文件夹：
```
我的工程/
├── inputs/          # 输入图片文件夹
├── outputs/         # 输出视频文件夹
├── project.json     # 工程配置文件
└── tasks.json       # 任务记录文件
```

#### 打开已有工程
- 使用菜单 "文件" -> "打开工程"
- 或在欢迎页面选择最近使用的工程
- 选择工程文件夹即可打开

#### 关闭工程
- 使用菜单 "文件" -> "关闭工程"
- 关闭后会返回到欢迎页面

## 技术栈

- **GUI 框架**：PyQt5
- **网络请求**：requests
- **异步处理**：QThread
- **数据持久化**：JSON / SQLite
- **API 服务**：阿里云 DashScope

## 注意事项

1. **工程管理**
   - 必须先创建或打开工程才能生成视频
   - 所有输入图片会自动复制到工程的 inputs 文件夹
   - 生成的视频会自动保存到工程的 outputs 文件夹
   - 每个工程独立管理自己的任务历史

2. **API 密钥**
   - API 密钥安全存储在系统配置中（使用 QSettings）
   - 无需手动编辑 .env 文件，可直接在界面配置
   - API 密钥可随时在设置中修改

3. **文件管理**
   - 图片大小建议不超过 10MB
   - 首次运行会自动创建必要的目录
   - 工程数据存储在各自的 tasks.json 文件中

## 打包发布

使用 PyInstaller 打包为独立可执行文件：

```bash
pip install pyinstaller
pyinstaller --name="图生视频" --windowed --icon=icon.ico main.py
```

## 技术支持

如遇问题请检查：
- API 密钥配置是否正确
- 网络连接是否正常
- Python 和依赖版本是否满足要求
