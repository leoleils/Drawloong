# 文生图功能说明

## 功能概述

通过文字描述生成图片，基于阿里云DashScope的通义千问图像生成模型，支持多种尺寸和智能提示词改写。

## 核心特性

### ✨ 主要功能

**1. 文字转图片**
```
输入文字描述 → AI生成图片 → 自动保存到工程
```

**2. 多模型支持**
```
✅ 通义千问Plus（推荐）- qwen-image-plus
✅ 通义千问标准版 - qwen-image
```

**3. 多尺寸选择**
```
✅ 1:1 正方形 (1024*1024)
✅ 16:9 横屏 (1280*720)
✅ 9:16 竖屏 (720*1280)
✅ 4:3 横屏 (1024*768)
✅ 3:4 竖屏 (768*1024)
✅ 大尺寸正方形 (1328*1328)
```

**4. 图片画廊**
```
✅ 网格布局展示
✅ 点击查看大图
✅ 自动保存历史
```

## 界面布局

### 整体结构

```
┌─────────────────────────────────────────────┐
│  配置面板                │  图片画廊         │
│  (40%)                  │  (60%)           │
├─────────────────────────┼──────────────────┤
│  描述文本               │  ┌───┬───┬───┐   │
│  [文本输入框]           │  │ 图 │ 图 │ 图 │   │
│                         │  └───┴───┴───┘   │
│  反向提示词             │  ┌───┬───┬───┐   │
│  [文本输入框]           │  │ 图 │ 图 │ 图 │   │
│                         │  └───┴───┴───┘   │
│  模型选择               │                   │
│  [通义千问Plus ▼]       │                   │
│                         │                   │
│  图片尺寸               │                   │
│  [1:1 (1024*1024) ▼]  │                   │
│                         │                   │
│  ☑ 启用智能改写         │                   │
│                         │                   │
│  [  生成图片  ]         │                   │
└─────────────────────────┴──────────────────┘
```

### 配置面板详情

```
┌─────────────────────────────┐
│  文生图配置                  │
├─────────────────────────────┤
│  描述文本:                   │
│  ┌─────────────────────────┐│
│  │描述你想要生成的图片内容...││
│  │例如：一副典雅庄重的对联...││
│  │                         ││
│  │                         ││
│  └─────────────────────────┘│
├─────────────────────────────┤
│  反向提示词:                 │
│  ┌─────────────────────────┐│
│  │描述不希望出现的内容...   ││
│  └─────────────────────────┘│
├─────────────────────────────┤
│  模型:                       │
│  [通义千问Plus（推荐）▼]    │
├─────────────────────────────┤
│  图片尺寸:                   │
│  [1:1 (1024*1024) ▼]       │
├─────────────────────────────┤
│  ☑ 启用提示词智能改写        │
├─────────────────────────────┤
│  [      生成图片      ]      │
└─────────────────────────────┘
```

### 图片画廊

```
┌─────────────────────────────────┐
│  ┌─────┐  ┌─────┐  ┌─────┐    │
│  │ 图片1│  │ 图片2│  │ 图片3│    │
│  │200px│  │200px│  │200px│    │
│  └─────┘  └─────┘  └─────┘    │
│  filename  filename  filename   │
│                                 │
│  ┌─────┐  ┌─────┐  ┌─────┐    │
│  │ 图片4│  │ 图片5│  │ 图片6│    │
│  └─────┘  └─────┘  └─────┘    │
│                                 │
└─────────────────────────────────┘
```

## 使用流程

### 基础流程

```
1. 输入描述文本
   → 详细描述你想要的图片内容

2. 选择模型和尺寸
   → 推荐使用通义千问Plus
   → 根据需求选择合适尺寸

3. 点击"生成图片"
   → 等待AI生成（通常10-30秒）

4. 查看结果
   → 图片自动显示在画廊中
   → 点击可查看大图
   → 自动保存到工程inputs文件夹
```

### 详细示例

#### 示例1：生成中式对联场景

**输入描述：**
```
一副典雅庄重的对联悬挂于厅堂之中，房间是个安静古典的中式布置，
桌子上放着一些青花瓷，对联上左书"义本生知人机同道善思新"，
右书"通云赋智乾坤启数高志远"， 横批"智启通义"，字体飘逸，
在中间挂着一幅中国风的画作，内容是岳阳楼。
```

**配置选择：**
```
模型：通义千问Plus
尺寸：16:9 (1280*720)
智能改写：✅ 启用
```

**生成结果：**
```
✅ 生成包含对联的中式场景图
✅ 保存到：inputs/text2img_20251212_102030.png
✅ 显示在画廊中
```

#### 示例2：生成产品概念图

**输入描述：**
```
一款现代简约风格的智能咖啡机，白色外壳，
触摸屏控制面板，放置在木质桌面上，
旁边有咖啡豆和咖啡杯，柔和的自然光照明
```

**配置选择：**
```
模型：通义千问Plus
尺寸：1:1 (1024*1024)
反向提示词：低质量，模糊，变形
智能改写：✅ 启用
```

**生成结果：**
```
✅ 生成产品概念效果图
✅ 可用于设计参考
✅ 保存到工程中
```

## 技术实现

### API调用

```python
url = 'https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation'

data = {
    "model": "qwen-image-plus",
    "input": {
        "messages": [
            {
                "role": "user",
                "content": [
                    {
                        "text": "用户的描述文本"
                    }
                ]
            }
        ]
    },
    "parameters": {
        "negative_prompt": "反向提示词",
        "prompt_extend": true,
        "watermark": false,
        "size": "1024*1024"
    }
}
```

### 异步处理

```python
class TextToImageWorker(QThread):
    """文生图工作线程"""
    
    finished = pyqtSignal(str, str)  # image_url, output_path
    error = pyqtSignal(str)
    
    def run(self):
        # 1. 调用API生成图片
        # 2. 下载图片到本地
        # 3. 发送完成信号
        pass
```

### 图片画廊

```python
class ImageGalleryWidget(QWidget):
    """图片画廊组件"""
    
    def add_image(self, image_path):
        """添加新图片到画廊"""
        self.images.insert(0, image_path)
        self.refresh_gallery()
    
    def refresh_gallery(self):
        """网格布局显示，每行3张"""
        columns = 3
        for i, image_path in enumerate(self.images):
            row = i // columns
            col = i % columns
            card = self.create_image_card(image_path)
            self.gallery_layout.addWidget(card, row, col)
```

## 模型对比

### 通义千问Plus vs 标准版

| 特性 | Plus版（推荐） | 标准版 |
|------|---------------|--------|
| 价格 | 💰 更优惠 | 💰 标准 |
| 能力 | ⭐⭐⭐⭐⭐ 相同 | ⭐⭐⭐⭐⭐ 相同 |
| 速度 | ⚡ 相同 | ⚡ 相同 |
| 推荐度 | ✅ 推荐 | 可选 |

**建议：** 优先使用Plus版本，价格更优惠且能力一致。

## 尺寸选择建议

### 按用途推荐

**社交媒体分享：**
```
✅ 1:1 (1024*1024) - 适合Instagram、微信朋友圈
✅ 正方形大 (1328*1328) - 高清正方形
```

**视频素材：**
```
✅ 16:9 (1280*720) - 横屏视频首帧
✅ 9:16 (720*1280) - 竖屏短视频
```

**印刷设计：**
```
✅ 4:3 (1024*768) - 传统横版
✅ 3:4 (768*1024) - 传统竖版
```

**电脑壁纸：**
```
✅ 16:9 (1280*720) - 标准屏幕比例
```

## 使用技巧

### 提示词优化

**✅ 好的提示词：**
```
详细描述：
- 主体内容（人物、物品、场景）
- 风格特征（写实、卡通、中国风）
- 环境细节（光线、背景、氛围）
- 视角构图（特写、全景、俯视）

示例：
"一只可爱的橘猫坐在窗台上，阳光透过窗户洒在它身上，
毛发清晰可见，背景是模糊的城市街景，温暖的午后氛围，
高清摄影风格"
```

**❌ 避免的提示词：**
```
太简单：
"一只猫" → 缺少细节

太复杂：
包含50个要素的长篇描述 → 可能冲突

模糊不清：
"好看的图片" → 没有明确指向
```

### 反向提示词使用

**常用反向提示词：**
```
质量问题：
"低质量，模糊，噪点，失真，变形"

内容问题：
"多余的手指，畸形，不协调，不自然"

风格问题：
"卡通，动漫" （如果要写实风格）
```

### 智能改写功能

**启用时机：**
```
✅ 提示词较短时 → 让AI扩展细节
✅ 首次尝试时 → 获得更好效果
✅ 不确定描述时 → 让AI优化

❌ 提示词很详细时 → 可能过度改写
❌ 特定需求时 → 保持原意
```

## 完整工作流程

### 场景：为产品生成宣传图

```
1. 点击"🎨 文生图"标签
   → 切换到文生图功能

2. 输入产品描述
   描述文本：
   "一款高端智能手表，深空灰色金属外壳，
    圆形AMOLED显示屏，显示时间和心率数据，
    放置在大理石桌面上，柔和的影棚灯光，
    商业产品摄影风格，4K高清"
   
   反向提示词：
   "低质量，模糊，塑料感，廉价"

3. 选择配置
   模型：通义千问Plus
   尺寸：1:1 (1024*1024)
   智能改写：✅

4. 点击"生成图片"
   → 等待生成（约15-20秒）

5. 查看结果
   → 图片显示在画廊中
   → 点击查看大图
   → 满意则用于宣传

6. 继续生成变体
   → 修改描述中的颜色、角度
   → 生成多个版本对比
```

## 与其他功能配合

### 配合首帧生视频

```
1. 文生图 → 生成产品图
2. 首帧生视频 → 选择生成的图片
3. 生成产品动画视频

优势：完整的内容创作流程
```

### 配合资源管理器

```
生成的图片自动保存到 inputs/
→ 在资源管理器中查看缩略图
→ 右键重命名整理
→ 拖拽到首帧生视频使用
```

### 配合图片查看器

```
画廊中点击图片
→ 打开图片查看器
→ 放大查看细节
→ 确认效果
```

## 注意事项

### 生成时间

```
正常情况：10-30秒
高峰时段：可能需要更长时间
大尺寸图片：生成时间稍长
```

### 文件保存

```
保存位置：工程的 inputs 文件夹
文件命名：text2img_时间戳.png
格式：PNG格式，支持透明通道
```

### API限制

```
请求频率：建议间隔2秒以上
图片数量：每次生成1张
文件大小：通常1-5MB
```

## 常见问题

### Q1: 生成的图片不理想怎么办？

**A:** 尝试以下方法：
```
1. 优化提示词 - 添加更多细节描述
2. 使用反向提示词 - 排除不想要的元素
3. 启用智能改写 - 让AI优化描述
4. 多次生成 - 选择最满意的结果
```

### Q2: 生成失败怎么办？

**A:** 检查以下方面：
```
1. 网络连接是否正常
2. API密钥是否有效
3. 提示词是否包含敏感内容
4. 稍后重试
```

### Q3: 可以生成什么样的图片？

**A:** 支持多种类型：
```
✅ 人物肖像
✅ 自然风景
✅ 产品效果图
✅ 场景插画
✅ 概念设计
✅ 艺术创作

❌ 避免：
- 侵权内容
- 暴力血腥
- 政治敏感
```

### Q4: 如何提高生成质量？

**A:** 最佳实践：
```
1. 详细的描述 - 包含主体、环境、光线、风格
2. 明确的风格 - 如"摄影风格"、"插画风格"
3. 合适的尺寸 - 根据用途选择
4. 反向提示词 - 排除常见问题
5. 多次尝试 - 对比选择最佳
```

---

**版本**: v1.6.0  
**更新日期**: 2025-12-12  
**功能状态**: ✅ 已实现

**开启AI图像创作之旅！** 🎨✨
