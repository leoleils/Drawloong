# 工程管理功能测试指南

本文档帮助你测试客户端的工程管理功能。

## 测试环境

- ✅ Python 3.7+
- ✅ PyQt5 已安装
- ✅ API 密钥已配置

## 测试步骤

### 1. 启动应用

```bash
cd /Users/chenleiyu/Desktop/wanx/qt_client
python main.py
```

应该看到欢迎页面，包含：
- 新建工程按钮
- 打开工程按钮
- 最近使用工程列表（首次使用为空）

### 2. 创建新工程

**操作步骤：**
1. 点击 "新建工程" 按钮或使用菜单 `文件` -> `新建工程`
2. 在对话框中输入：
   - 工程名称：`测试工程`
   - 选择位置：选择一个文件夹（如桌面）
   - 工程描述：`这是一个测试工程`（可选）
3. 点击 "创建" 按钮

**预期结果：**
- ✅ 弹出成功提示
- ✅ 界面切换到工作区（三栏布局）
- ✅ 左侧资源管理器显示工程结构：
  ```
  测试工程
  ├── 📁 inputs
  └── 📁 outputs
  ```
- ✅ 顶部显示工程名称 "测试工程"
- ✅ 在选择的位置创建了工程文件夹，包含：
  - `inputs/` 文件夹
  - `outputs/` 文件夹
  - `project.json` 文件
  - `tasks.json` 文件

### 3. 上传图片

**操作步骤：**
1. 拖拽一张图片到上传区域，或点击 "选择图片" 按钮
2. 选择一张图片（支持 PNG、JPG 格式）

**预期结果：**
- ✅ 图片预览显示在上传区域
- ✅ 状态栏显示 "已选择图片: xxx.jpg"
- ✅ "生成视频" 按钮变为可用状态

### 4. 生成视频

**操作步骤：**
1. 在配置面板中：
   - 输入提示词：`一个美丽的风景视频`
   - 选择模型：`wanx2.1-t2v-turbo`
   - 选择分辨率：`1280*720`
2. 点击 "生成视频" 按钮

**预期结果：**
- ✅ 弹出 "视频生成任务已提交！" 提示
- ✅ 图片被复制到工程的 `inputs` 文件夹
- ✅ 左侧资源管理器刷新，显示新增的图片文件
- ✅ 任务列表中出现新任务，状态为 "RUNNING"
- ✅ 状态栏显示 "任务已提交，正在处理中..."

### 5. 监控任务进度

**操作步骤：**
1. 观察任务列表中的任务状态变化

**预期结果：**
- ✅ 任务状态自动更新（PENDING -> RUNNING -> SUCCEEDED/FAILED）
- ✅ 任务完成后，状态变为 "SUCCEEDED"，背景色为绿色
- ✅ 视频文件自动保存到工程的 `outputs` 文件夹
- ✅ 左侧资源管理器自动刷新，显示生成的视频文件
- ✅ 任务列表中出现 "下载" 按钮

### 6. 查看生成的文件

**操作步骤：**
1. 在资源管理器中展开 `outputs` 文件夹
2. 双击视频文件（或右键菜单）

**预期结果：**
- ✅ `outputs` 文件夹中有生成的 `.mp4` 视频文件
- ✅ 文件名格式为 `{任务ID}.mp4`
- ✅ 可以在系统文件管理器中打开该文件夹

### 7. 关闭工程

**操作步骤：**
1. 使用菜单 `文件` -> `关闭工程`
2. 在确认对话框中点击 "是"

**预期结果：**
- ✅ 界面切换回欢迎页面
- ✅ 资源管理器清空
- ✅ 最近使用工程列表中出现 "测试工程"

### 8. 重新打开工程

**操作步骤：**
1. 在欢迎页面的最近使用列表中点击 "测试工程"
   或使用菜单 `文件` -> `打开工程`，选择工程文件夹

**预期结果：**
- ✅ 工程成功打开
- ✅ 资源管理器显示之前的文件结构
- ✅ 任务列表显示之前的任务历史
- ✅ inputs 和 outputs 文件夹中的文件都还在

### 9. 测试多工程切换

**操作步骤：**
1. 创建第二个工程 "测试工程2"
2. 在两个工程间切换

**预期结果：**
- ✅ 每个工程独立管理自己的文件
- ✅ 切换工程时，资源管理器和任务列表正确更新
- ✅ 生成的视频保存到对应工程的 outputs 文件夹

## 工程文件结构验证

打开工程文件夹，应该看到以下结构：

```
测试工程/
├── inputs/
│   └── {上传的图片文件}
├── outputs/
│   └── {生成的视频文件}.mp4
├── project.json          # 工程配置
└── tasks.json           # 任务历史
```

**验证 project.json 内容：**
```json
{
  "name": "测试工程",
  "description": "这是一个测试工程",
  "created_at": "2025-12-11T...",
  "version": "1.0"
}
```

**验证 tasks.json 内容：**
```json
[
  {
    "id": "...",
    "prompt": "一个美丽的风景视频",
    "model": "wanx2.1-t2v-turbo",
    "resolution": "1280*720",
    "status": "SUCCEEDED",
    "input_file": ".../inputs/xxx.jpg",
    "output_path": ".../outputs/xxx.mp4",
    ...
  }
]
```

## 常见问题排查

### 问题 1：无法创建工程

**可能原因：**
- 选择的位置没有写入权限
- 工程名称包含特殊字符

**解决方案：**
- 选择有权限的文件夹（如 Documents、Desktop）
- 使用简单的中文或英文名称

### 问题 2：图片未复制到 inputs 文件夹

**可能原因：**
- 未打开工程就尝试生成视频

**解决方案：**
- 确保先创建或打开工程
- 应用会提示 "请先创建或打开工程"

### 问题 3：视频未保存到 outputs 文件夹

**可能原因：**
- 任务失败
- 网络问题导致下载失败

**解决方案：**
- 检查任务状态是否为 SUCCEEDED
- 查看任务列表中的错误信息
- 检查网络连接

### 问题 4：资源管理器未刷新

**可能原因：**
- 需要手动刷新

**解决方案：**
- 点击资源管理器的刷新按钮
- 或重新打开工程

## 性能测试

### 测试场景 1：批量任务

1. 连续上传 5 张图片并生成视频
2. 观察任务列表和资源管理器的更新

**预期：**
- ✅ 所有任务正常排队执行
- ✅ 所有图片保存到 inputs 文件夹
- ✅ 所有视频保存到 outputs 文件夹
- ✅ UI 不卡顿

### 测试场景 2：大文件处理

1. 上传一张 8-10MB 的图片
2. 生成视频

**预期：**
- ✅ 上传成功
- ✅ 复制到 inputs 不卡顿
- ✅ 视频下载正常

## 测试结论

完成以上测试后，请确认：

- [ ] 工程管理功能正常
- [ ] 文件自动组织正确
- [ ] 任务历史独立管理
- [ ] 界面切换流畅
- [ ] 资源管理器实时更新
- [ ] 最近使用列表正常

如有问题，请查看控制台输出或联系技术支持。
