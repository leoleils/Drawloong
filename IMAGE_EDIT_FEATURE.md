# å›¾åƒç¼–è¾‘åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

å›¾åƒç¼–è¾‘åŠŸèƒ½æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
1. **å•å›¾ç¼–è¾‘**ï¼šå¯¹å•å¼ å›¾ç‰‡è¿›è¡Œç¼–è¾‘å¤„ç†
2. **å¤šå›¾èåˆ**ï¼šå°†2-3å¼ å›¾ç‰‡èåˆæˆæ–°çš„å›¾åƒ

## åŠŸèƒ½ç‰¹ç‚¹

### æ”¯æŒçš„æ¨¡å‹
- `qwen-image-edit-plus`
- `qwen-image-edit-plus-2025-10-30`

### ä¸»è¦å‚æ•°
- **ç”Ÿæˆæ•°é‡ (n)**ï¼š1-6å¼ ï¼Œé»˜è®¤2å¼ 
- **åå‘æç¤ºè¯**ï¼šæè¿°ä¸å¸Œæœ›å‡ºç°çš„å†…å®¹
- **æ™ºèƒ½æ”¹å†™**ï¼šè‡ªåŠ¨ä¼˜åŒ–æç¤ºè¯

### æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
- JPG/JPEG
- PNG
- BMP
- TIFF
- WEBP
- GIF

## ä½¿ç”¨æ–¹æ³•

### å•å›¾ç¼–è¾‘

1. åœ¨ä¸»çª—å£é€‰æ‹©"âœ‚ï¸ å›¾åƒç¼–è¾‘"æ ‡ç­¾é¡µ
2. ç¼–è¾‘æ¨¡å¼é€‰æ‹©"ğŸ–¼ï¸ å•å›¾ç¼–è¾‘"
3. ç‚¹å‡»"æ·»åŠ å›¾ç‰‡"æŒ‰é’®ï¼Œé€‰æ‹©1å¼ å›¾ç‰‡
4. åœ¨"ç¼–è¾‘æè¿°"ä¸­è¾“å…¥æƒ³è¦çš„ç¼–è¾‘æ•ˆæœï¼Œä¾‹å¦‚ï¼š
   ```
   ç”Ÿæˆä¸€å¼ ç¬¦åˆæ·±åº¦å›¾çš„å›¾åƒï¼Œéµå¾ªä»¥ä¸‹æè¿°ï¼šä¸€è¾†çº¢è‰²çš„ç ´æ—§çš„è‡ªè¡Œè½¦åœåœ¨ä¸€æ¡æ³¥æ³çš„å°è·¯ä¸Šï¼ŒèƒŒæ™¯æ˜¯èŒ‚å¯†çš„åŸå§‹æ£®æ—
   ```
5. ï¼ˆå¯é€‰ï¼‰è®¾ç½®åå‘æç¤ºè¯ã€ç”Ÿæˆæ•°é‡ç­‰å‚æ•°
6. ç‚¹å‡»"å¼€å§‹ç¼–è¾‘"æŒ‰é’®
7. ç­‰å¾…å¤„ç†å®Œæˆï¼Œç”Ÿæˆçš„å›¾ç‰‡ä¼šæ˜¾ç¤ºåœ¨å³ä¾§ç”»å»Šä¸­

### å¤šå›¾èåˆ

1. åœ¨ä¸»çª—å£é€‰æ‹©"âœ‚ï¸ å›¾åƒç¼–è¾‘"æ ‡ç­¾é¡µ
2. ç¼–è¾‘æ¨¡å¼é€‰æ‹©"ğŸ­ å¤šå›¾èåˆ"
3. ç‚¹å‡»"æ·»åŠ å›¾ç‰‡"æŒ‰é’®ï¼Œé€‰æ‹©2-3å¼ å›¾ç‰‡
4. åœ¨"ç¼–è¾‘æè¿°"ä¸­è¾“å…¥èåˆè¦æ±‚ï¼Œä¾‹å¦‚ï¼š
   ```
   å›¾1ä¸­çš„å¥³ç”Ÿç©¿ç€å›¾2ä¸­çš„é»‘è‰²è£™å­æŒ‰å›¾3çš„å§¿åŠ¿åä¸‹
   ```
5. ï¼ˆå¯é€‰ï¼‰è®¾ç½®åå‘æç¤ºè¯ã€ç”Ÿæˆæ•°é‡ç­‰å‚æ•°
6. ç‚¹å‡»"å¼€å§‹ç¼–è¾‘"æŒ‰é’®
7. ç­‰å¾…å¤„ç†å®Œæˆï¼Œç”Ÿæˆçš„å›¾ç‰‡ä¼šæ˜¾ç¤ºåœ¨å³ä¾§ç”»å»Šä¸­

## API æ¥å£è¯´æ˜

### å•å›¾ç¼–è¾‘

```bash
curl --location 'https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation' \
--header 'Content-Type: application/json' \
--header "Authorization: Bearer $DASHSCOPE_API_KEY" \
--data '{
    "model": "qwen-image-edit-plus",
    "input": {
        "messages": [
            {
                "role": "user",
                "content": [
                    {
                        "image": "data:image/jpeg;base64,{base64_data}"
                    },
                    {
                        "text": "ç”Ÿæˆä¸€å¼ ç¬¦åˆæ·±åº¦å›¾çš„å›¾åƒ..."
                    }
                ]
            }
        ]
    },
    "parameters": {
        "n": 2,
        "negative_prompt": " ",
        "prompt_extend": true,
        "watermark": false
    }
}'
```

### å¤šå›¾èåˆ

```bash
curl --location 'https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation' \
--header 'Content-Type: application/json' \
--header "Authorization: Bearer $DASHSCOPE_API_KEY" \
--data '{
    "model": "qwen-image-edit-plus",
    "input": {
        "messages": [
            {
                "role": "user",
                "content": [
                    {
                        "image": "data:image/jpeg;base64,{base64_data_1}"
                    },
                    {
                        "image": "data:image/jpeg;base64,{base64_data_2}"
                    },
                    {
                        "image": "data:image/jpeg;base64,{base64_data_3}"
                    },
                    {
                        "text": "å›¾1ä¸­çš„å¥³ç”Ÿç©¿ç€å›¾2ä¸­çš„é»‘è‰²è£™å­æŒ‰å›¾3çš„å§¿åŠ¿åä¸‹"
                    }
                ]
            }
        ]
    },
    "parameters": {
        "n": 2,
        "negative_prompt": " ",
        "prompt_extend": true,
        "watermark": false
    }
}'
```

## è¿”å›æ ¼å¼

### æˆåŠŸå“åº”

```json
{
    "output": {
        "choices": [
            {
                "finish_reason": "stop",
                "message": {
                    "role": "assistant",
                    "content": [
                        {
                            "image": "https://dashscope-result-sz.oss-cn-shenzhen.aliyuncs.com/xxx.png?Expires=xxx"
                        },
                        {
                            "image": "https://dashscope-result-sz.oss-cn-shenzhen.aliyuncs.com/xxx.png?Expires=xxx"
                        }
                    ]
                }
            }
        ]
    },
    "usage": {
        "width": 1248,
        "image_count": 2,
        "height": 832
    },
    "request_id": "bf37ca26-0abe-98e4-8065-xxxxxx"
}
```

### é”™è¯¯å“åº”

```json
{
    "request_id": "31f808fd-8eef-9004-xxxxx",
    "code": "InvalidApiKey",
    "message": "Invalid API-key provided."
}
```

## å®ç°ç»†èŠ‚

### æ–‡ä»¶ç»“æ„

```
qt_client/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ api_client.py          # æ·»åŠ  submit_image_edit æ–¹æ³•
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ image_edit_widget.py   # å›¾åƒç¼–è¾‘ç»„ä»¶ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ main_window.py         # é›†æˆå›¾åƒç¼–è¾‘æ ‡ç­¾é¡µ
```

### æ ¸å¿ƒç»„ä»¶

1. **ImageEditWorker**ï¼šå·¥ä½œçº¿ç¨‹ï¼Œè´Ÿè´£å¼‚æ­¥è°ƒç”¨API
2. **ImageGalleryWidget**ï¼šç»“æœç”»å»Šï¼Œå±•ç¤ºç”Ÿæˆçš„å›¾ç‰‡
3. **ImageEditWidget**ï¼šä¸»ç»„ä»¶ï¼ŒåŒ…å«é…ç½®é¢æ¿å’Œç»“æœå±•ç¤º

### API å®¢æˆ·ç«¯

åœ¨ `DashScopeClient` ç±»ä¸­æ–°å¢ï¼š
- `submit_image_edit()` æ–¹æ³•ï¼šæ”¯æŒå•å›¾ç¼–è¾‘å’Œå¤šå›¾èåˆ

## æ³¨æ„äº‹é¡¹

1. **å›¾ç‰‡é€‰æ‹©é™åˆ¶**ï¼š
   - å•å›¾ç¼–è¾‘ï¼šå¿…é¡»é€‰æ‹©1å¼ å›¾ç‰‡
   - å¤šå›¾èåˆï¼šéœ€è¦é€‰æ‹©2-3å¼ å›¾ç‰‡

2. **å›¾ç‰‡æ ¼å¼**ï¼š
   - æ”¯æŒå¸¸è§å›¾ç‰‡æ ¼å¼ï¼ˆJPG/PNG/BMP/TIFF/WEBP/GIFï¼‰
   - è‡ªåŠ¨è¯†åˆ«MIMEç±»å‹å¹¶è¿›è¡ŒBase64ç¼–ç 

3. **ç”Ÿæˆç»“æœ**ï¼š
   - ç”Ÿæˆçš„å›¾ç‰‡ä¿å­˜åœ¨å½“å‰å·¥ç¨‹çš„ `inputs` æ–‡ä»¶å¤¹
   - æ–‡ä»¶å‘½åæ ¼å¼ï¼š`image_edit_YYYYMMDD_HHMMSS_N.png`
   - ç»“æœä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨å³ä¾§ç”»å»Šä¸­

4. **APIå¯†é’¥**ï¼š
   - éœ€è¦åœ¨è®¾ç½®ä¸­é…ç½®æœ‰æ•ˆçš„ `DASHSCOPE_API_KEY`
   - APIè°ƒç”¨ä¼šæ¶ˆè€—é…é¢

## æµ‹è¯•å»ºè®®

### å•å›¾ç¼–è¾‘æµ‹è¯•

1. å‡†å¤‡ä¸€å¼ æµ‹è¯•å›¾ç‰‡ï¼ˆå¦‚é£æ™¯ç…§ï¼‰
2. æµ‹è¯•æ·±åº¦å›¾ç”Ÿæˆ
3. æµ‹è¯•é£æ ¼è½¬æ¢
4. æµ‹è¯•ç‰©ä½“æ›¿æ¢

### å¤šå›¾èåˆæµ‹è¯•

1. å‡†å¤‡2-3å¼ ç›¸å…³å›¾ç‰‡ï¼ˆå¦‚äººç‰©+æœè£…+å§¿åŠ¿ï¼‰
2. æµ‹è¯•äººç‰©æ¢è£…
3. æµ‹è¯•å§¿åŠ¿è¿ç§»
4. æµ‹è¯•åœºæ™¯èåˆ

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. æ”¯æŒæ‰¹é‡ç¼–è¾‘
2. å†å²è®°å½•ä¿å­˜
3. å‚æ•°é¢„è®¾
4. æ›´å¤šæ¨¡å‹æ”¯æŒ
5. ç¼–è¾‘å†å²å¯¹æ¯”
