# 视频浏览器功能说明

## 功能概述

新增视频浏览器组件，支持在客户端内直接播放视频，无需打开外部播放器。

## 界面布局调整

### 之前的布局

```
┌────────────────────────────────────────┐
│  资源管理器  │  上传区域  │  配置面板  │
│              ├─────────────────────────┤
│              │      任务列表            │
└────────────────────────────────────────┘
```

### 现在的布局

```
┌────────────────────────────────────────┐
│  资源管理器  │  上传区域  │  配置面板  │
│              ├──────────┬──────────────┤
│              │视频浏览器│  任务列表     │
│              │(左下)    │  (右下)      │
└────────────────────────────────────────┘
```

### 布局特点

**左下角：视频浏览器**
- 占比：40% 宽度
- 功能：播放工程输出视频
- 控制：播放/暂停、停止

**右下角：任务列表**
- 占比：60% 宽度
- 功能：显示任务历史和状态
- 优化：移除下载按钮，界面更简洁

## 视频浏览器功能

### 核心特性

**1. 内嵌播放**
```
✅ 在客户端内直接播放
✅ 无需打开外部播放器
✅ 流畅的工作流程
✅ 统一的用户体验
```

**2. 播放控制**
```
▶ 播放/暂停 - 切换播放状态
■ 停止 - 停止播放并返回开始
自动播放 - 加载视频后自动开始播放
```

**3. 智能状态**
```
空状态：显示"👤 点击输出视频进行播放"
加载状态：显示视频名称
播放状态：显示播放/暂停按钮状态
```

### 使用方法

#### 方法一：点击输出视频

```
1. 在资源管理器中展开 outputs 文件夹
2. 单击或双击视频文件
3. 视频自动在左下角播放器中播放
4. 使用控制按钮控制播放
```

#### 方法二：任务完成后查看

```
1. 任务列表显示"成功"状态
2. 切换到资源管理器
3. 在 outputs 文件夹中点击视频
4. 在视频浏览器中查看成果
```

### 视觉效果

#### 空状态

```
┌─────────────────────────────┐
│      视频浏览               │
├─────────────────────────────┤
│                             │
│   👤 点击输出视频进行播放    │
│                             │
├─────────────────────────────┤
│ 未加载视频  [▶ 播放] [■ 停止] │
└─────────────────────────────┘
```

#### 播放状态

```
┌─────────────────────────────┐
│      视频浏览               │
├─────────────────────────────┤
│                             │
│   [视频画面正在播放...]      │
│                             │
├─────────────────────────────┤
│ 视频: output.mp4 [⏸ 暂停] [■ 停止] │
└─────────────────────────────┘
```

## 智能播放逻辑

### 文件类型判断

**点击输出视频（outputs 文件夹）：**
```python
if file_path.startswith(project.outputs_folder):
    # 在视频浏览器中播放
    self.video_viewer.load_video(file_path)
```

**点击其他视频文件：**
```python
else:
    # 使用系统播放器
    VideoPlayer.play(file_path, self)
```

### 播放策略

| 视频位置 | 播放方式 | 原因 |
|---------|---------|------|
| outputs/ | 内嵌播放器 | 工程输出，方便对比和查看 |
| inputs/ | 系统播放器 | 输入素材，偶尔查看 |
| 其他位置 | 系统播放器 | 非工程文件，保持灵活性 |

## 技术实现

### VideoViewerWidget 组件

**核心类：**
```python
class VideoViewerWidget(QWidget):
    """视频浏览器组件"""
    
    def __init__(self, parent=None):
        self.media_player = QMediaPlayer()
        self.video_widget = QVideoWidget()
        self.media_player.setVideoOutput(self.video_widget)
    
    def load_video(self, video_path):
        """加载并播放视频"""
        media_content = QMediaContent(QUrl.fromLocalFile(video_path))
        self.media_player.setMedia(media_content)
        self.media_player.play()
```

**使用的 Qt 组件：**
- `QMediaPlayer` - 媒体播放器核心
- `QVideoWidget` - 视频显示控件
- `QMediaContent` - 媒体内容管理

### 主窗口布局

**布局层次：**
```
MainWindow
  └─ QSplitter (水平)
      ├─ ProjectExplorer (左侧)
      └─ ContentWidget (右侧)
          └─ QSplitter (垂直)
              ├─ TopWidget (上)
              │   ├─ UploadWidget
              │   └─ ConfigPanel
              └─ BottomWidget (下)
                  ├─ VideoViewerWidget (左 40%)
                  └─ TaskListWidget (右 60%)
```

**比例设置：**
```python
# 视频浏览器 : 任务列表 = 2 : 3
bottom_layout.addWidget(self.video_viewer, stretch=2)
bottom_layout.addWidget(self.task_list, stretch=3)
```

## 使用场景

### 场景 1：视频生成后立即查看

**工作流程：**
```
1. 上传图片并配置参数
2. 点击"生成视频"
3. 任务列表显示进度
4. 任务成功后
5. 点击 outputs 中的视频
6. 在视频浏览器中立即查看效果
```

**优势：**
- ✅ 无需离开客户端
- ✅ 快速查看生成结果
- ✅ 方便与原图对比

### 场景 2：多版本视频对比

**工作流程：**
```
1. 生成视频 v1，点击查看
2. 调整参数
3. 生成视频 v2，点击查看
4. 在资源管理器中切换不同版本
5. 在视频浏览器中对比效果
```

**优势：**
- ✅ 快速切换不同版本
- ✅ 统一的查看体验
- ✅ 高效的对比流程

### 场景 3：视频质量检查

**工作流程：**
```
1. 批量生成多个视频
2. 在资源管理器中浏览列表
3. 逐个点击视频查看
4. 发现问题视频
5. 重新生成或调整参数
```

**优势：**
- ✅ 连续查看效率高
- ✅ 不需要切换窗口
- ✅ 便于质量管控

## 与其他功能配合

### 配合资源管理器

```
资源管理器 → 点击视频
     ↓
视频浏览器 → 自动播放
     ↓
播放控制 → 暂停/停止/重播
```

### 配合任务列表

```
任务列表 → 显示"成功"
     ↓
资源管理器 → 找到输出视频
     ↓
视频浏览器 → 查看生成结果
```

### 配合图片上传

```
上传图片 → 生成视频
     ↓
视频浏览器 → 查看效果
     ↓
满意 → 保留
不满意 → 调整参数重新生成
```

## 性能优化

### 资源管理

**自动释放：**
```python
def clear(self):
    """清空视频"""
    self.media_player.stop()
    self.media_player.setMedia(QMediaContent())
```

**状态切换：**
```
空状态 → 隐藏视频控件，节省资源
播放状态 → 显示视频控件，正常播放
```

### 内存优化

- 单实例播放器 - 避免多个播放器占用内存
- 按需加载 - 只加载当前播放的视频
- 自动清理 - 切换视频时清理上一个

## 界面细节

### 控制按钮样式

**播放/暂停按钮：**
```css
background-color: #28a745 (绿色)
hover: #218838 (深绿)
padding: 6px 12px
border-radius: 4px
min-width: 80px
```

**停止按钮：**
```css
background-color: #dc3545 (红色)
hover: #c82333 (深红)
padding: 6px 12px
border-radius: 4px
min-width: 80px
```

### 视频显示区域

**样式：**
```css
background-color: #000 (黑色背景)
min-height: 300px
```

**空状态提示：**
```
颜色: #999 (灰色)
字体: 14px
居中对齐
背景: 黑色
```

## 快捷操作

### 键盘快捷键（未来可扩展）

```
空格键 → 播放/暂停
ESC → 停止播放
← → → 快进/快退
F → 全屏播放
```

### 鼠标操作

```
单击视频 → 暂停/播放
双击视频 → 全屏播放（未来）
右键视频 → 显示菜单（未来）
```

## 错误处理

### 文件不存在

```
提示: "视频文件不存在"
操作: 保持空状态
```

### 播放错误

```
提示: "无法播放视频: [错误信息]"
操作: 停止播放，显示错误
```

### 格式不支持

```
提示: 播放器错误信息
建议: 使用系统播放器打开
```

## 未来优化方向

### 功能增强

- [ ] 全屏播放模式
- [ ] 播放进度条
- [ ] 音量控制
- [ ] 播放速度调节
- [ ] 视频截图功能
- [ ] 循环播放选项

### 性能优化

- [ ] 硬件加速解码
- [ ] 预加载下一个视频
- [ ] 缩略图预览
- [ ] 播放历史记录

### 用户体验

- [ ] 拖拽视频到播放器
- [ ] 播放列表功能
- [ ] A/B对比模式
- [ ] 视频元信息显示

---

**版本**: v1.4.0  
**更新日期**: 2025-12-12  
**功能状态**: ✅ 已实现

**享受内嵌视频播放的便捷体验！** 🎬✨
