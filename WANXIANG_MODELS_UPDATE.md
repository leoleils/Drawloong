# 万相文生图模型升级说明

## 升级概述

文生图功能新增3个万相（Wanx）文生图模型，支持更灵活的分辨率配置和更强大的图像生成能力。

## 新增模型

### 🌟 万相2.5 Preview（推荐）

**模型ID**: `wan2.5-t2i-preview`

**核心特点**：
- ✅ **灵活分辨率** - 支持自定义宽高比
- ✅ **高质量输出** - 最新版本模型
- ✅ **广泛适配** - 适合各种场景

**分辨率约束**：
```
总像素范围：[768*768, 1440*1440]
宽高比范围：[1:4, 4:1]
默认分辨率：1280*1280
```

**支持的分辨率**：
```
1:1 (1280*1280) - 默认，高清正方形
1:1 (1024*1024) - 标准正方形
16:9 (1440*810) - 横屏视频比例
9:16 (810*1440) - 竖屏视频比例
4:3 (1248*936)  - 传统横版比例
3:4 (936*1248)  - 传统竖版比例
2:1 (1440*720)  - 超宽横屏
1:2 (720*1440)  - 超长竖屏
```

**约束规则示例**：
```
✅ 支持：768*2700 - 总像素=2,073,600，在范围内，宽高比≈1:3.5
✅ 支持：1440*1440 - 最大分辨率
✅ 支持：1200*800 - 宽高比=3:2，在[1:4, 4:1]范围内
❌ 不支持：700*700 - 总像素=490,000，小于768*768
❌ 不支持：1500*1500 - 总像素=2,250,000，大于1440*1440
❌ 不支持：1440*300 - 宽高比=4.8:1，超出[1:4, 4:1]
```

### 🌟 万相2.2 极速版（推荐）

**模型ID**: `wan2.2-t2i-flash`

**核心特点**：
- ⚡ **生成速度快** - 极速生成模式
- ✅ **高性价比** - 速度与质量平衡
- ✅ **稳定可靠** - 成熟稳定

**分辨率约束**：
```
宽高范围：[512, 1440]
最大分辨率：1440*1440
默认分辨率：1024*1024
```

**支持的分辨率**：
```
1:1 (1024*1024) - 默认，标准正方形
1:1 (1440*1440) - 高清正方形
16:9 (1440*810) - 横屏视频比例
9:16 (810*1440) - 竖屏视频比例
4:3 (1248*936)  - 传统横版比例
3:4 (936*1248)  - 传统竖版比例
2:1 (1440*720)  - 超宽横屏
1:2 (720*1440)  - 超长竖屏
```

**约束规则示例**：
```
✅ 支持：1024*1024 - 默认分辨率
✅ 支持：1440*810 - 单边≤1440
✅ 支持：512*512 - 最小分辨率
❌ 不支持：768*2700 - 高度2700超出单边限制1440
❌ 不支持：1500*1000 - 宽度1500超出1440
❌ 不支持：400*400 - 小于最小值512
```

### 🌟 万相2.2 专业版（推荐）

**模型ID**: `wan2.2-t2i-plus`

**核心特点**：
- 🎨 **专业品质** - 更高的生成质量
- ✅ **细节丰富** - 适合专业设计
- ✅ **稳定输出** - 结果可预测

**分辨率约束**：
```
宽高范围：[512, 1440]
最大分辨率：1440*1440
默认分辨率：1024*1024
```

**支持的分辨率**：
```
1:1 (1024*1024) - 默认，标准正方形
1:1 (1440*1440) - 高清正方形
16:9 (1440*810) - 横屏视频比例
9:16 (810*1440) - 竖屏视频比例
4:3 (1248*936)  - 传统横版比例
3:4 (936*1248)  - 传统竖版比例
2:1 (1440*720)  - 超宽横屏
1:2 (720*1440)  - 超长竖屏
```

## 模型对比

### 万相系列 vs 通义千问

| 特性 | 万相2.5 | 万相2.2 Flash | 万相2.2 Plus | 通义千问Plus |
|------|---------|--------------|-------------|-------------|
| **推荐度** | 🌟🌟🌟🌟🌟 | 🌟🌟🌟🌟🌟 | 🌟🌟🌟🌟🌟 | ⭐⭐⭐⭐ |
| **分辨率类型** | 灵活 | 固定 | 固定 | 预设 |
| **默认分辨率** | 1280*1280 | 1024*1024 | 1024*1024 | 1328*1328 |
| **最大分辨率** | 1440*1440 | 1440*1440 | 1440*1440 | 1664*928 |
| **宽高比** | 1:4 - 4:1 | 不限 | 不限 | 预设 |
| **生成速度** | ⚡⚡⚡⚡ | ⚡⚡⚡⚡⚡ | ⚡⚡⚡ | ⚡⚡⚡ |
| **图像质量** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

### 模型选择建议

**万相2.5 Preview（推荐首选）**
```
✅ 适合场景：
- 需要特殊宽高比的场景
- 超宽或超长图片需求
- 最新技术体验

❌ 不适合：
- 对分辨率约束不了解的新手
```

**万相2.2 极速版（推荐速度优先）**
```
✅ 适合场景：
- 快速原型设计
- 大批量生成
- 对速度有要求

❌ 不适合：
- 追求极致质量的专业设计
```

**万相2.2 专业版（推荐质量优先）**
```
✅ 适合场景：
- 专业设计作品
- 营销物料制作
- 高质量需求

❌ 不适合：
- 快速迭代测试
```

**通义千问Plus**
```
✅ 适合场景：
- 预设分辨率满足需求
- 熟悉的模型选择

❌ 不适合：
- 追求最新技术
```

## 技术实现

### 模型配置结构

```python
MODEL_CONFIG = {
    'wan2.5-t2i-preview': {
        'name': '万相2.5 Preview（推荐）',
        'default_size': '1280*1280',
        'description': '支持灵活分辨率，总像素[768², 1440²]，宽高比[1:4, 4:1]',
        'size_type': 'flexible',  # 灵活分辨率
        'presets': [
            '1:1 (1280*1280)',
            '1:1 (1024*1024)',
            '16:9 (1440*810)',
            '9:16 (810*1440)',
            '4:3 (1248*936)',
            '3:4 (936*1248)',
            '2:1 (1440*720)',
            '1:2 (720*1440)'
        ]
    },
    # ... 其他模型
}
```

### 分辨率类型说明

**1. flexible（灵活分辨率）**
```
特点：
- 支持自定义宽高
- 有总像素限制
- 有宽高比限制

适用：wan2.5-t2i-preview
```

**2. fixed（固定分辨率）**
```
特点：
- 固定宽高范围
- 单边最大值限制
- 无宽高比限制

适用：wan2.2-t2i-flash, wan2.2-t2i-plus
```

**3. preset（预设分辨率）**
```
特点：
- 只能选择预设值
- 不支持自定义
- 共65种预设

适用：qwen-image-plus, qwen-image
```

### 智能切换逻辑

```python
def on_model_changed(self, index):
    """模型改变事件 - 更新尺寸选项"""
    model_key = self.model_combo.itemData(index)
    model_config = self.MODEL_CONFIG.get(model_key, {})
    
    # 1. 更新模型说明
    self.model_desc_label.setText(model_config['description'])
    
    # 2. 保存当前选择
    current_size = self.size_combo.currentData()
    
    # 3. 更新尺寸选项
    self.size_combo.clear()
    for preset in model_config['presets']:
        size_value = preset.split('(')[1].rstrip(')')
        self.size_combo.addItem(preset, size_value)
    
    # 4. 智能恢复选择
    # 尝试保持之前的选择，否则使用默认值
```

## 界面更新

### 模型下拉框

**新增星标推荐：**
```
🌟 万相2.5 Preview（推荐）     ← 新增，默认选中
🌟 万相2.2 极速版（推荐）        ← 新增
🌟 万相2.2 专业版（推荐）        ← 新增
通义千问Plus
通义千问标准版
```

### 模型说明标签（新增）

**显示位置**：模型选择下拉框下方

**显示内容**：
```
万相2.5：支持灵活分辨率，总像素[768², 1440²]，宽高比[1:4, 4:1]
万相2.2 Flash：图像宽高[512, 1440]，最大分辨率1440*1440
万相2.2 Plus：图像宽高[512, 1440]，最大分辨率1440*1440
通义千问：支持65种预设分辨率
```

**样式**：
```css
QLabel {
    color: #666;
    font-size: 11px;
    padding: 5px;
    background: #f8f9fa;
    border-radius: 3px;
}
```

### 尺寸下拉框

**动态更新**：根据选择的模型显示对应的分辨率选项

**万相2.5示例**：
```
1:1 (1280*1280)  ← 默认
1:1 (1024*1024)
16:9 (1440*810)
9:16 (810*1440)
4:3 (1248*936)
3:4 (936*1248)
2:1 (1440*720)
1:2 (720*1440)
```

**万相2.2示例**：
```
1:1 (1024*1024)  ← 默认
1:1 (1440*1440)
16:9 (1440*810)
9:16 (810*1440)
4:3 (1248*936)
3:4 (936*1248)
2:1 (1440*720)
1:2 (720*1440)
```

## 使用示例

### 场景1：生成超宽海报（使用万相2.5）

**步骤：**
```
1. 选择模型：🌟 万相2.5 Preview（推荐）
2. 选择尺寸：2:1 (1440*720) - 超宽横屏
3. 输入描述：一幅超宽的山水风景画，远山层叠，云雾缭绕
4. 点击生成
```

**输出：**
```
分辨率：1440*720
宽高比：2:1（超宽）
适合：网页Banner、横幅广告
```

### 场景2：快速生成产品图（使用万相2.2 Flash）

**步骤：**
```
1. 选择模型：🌟 万相2.2 极速版（推荐）
2. 选择尺寸：1:1 (1024*1024) - 标准正方形
3. 输入描述：一款现代简约的智能手表，白色外壳
4. 点击生成
```

**输出：**
```
分辨率：1024*1024
生成速度：快速
适合：产品原型、快速迭代
```

### 场景3：专业设计作品（使用万相2.2 Plus）

**步骤：**
```
1. 选择模型：🌟 万相2.2 专业版（推荐）
2. 选择尺寸：1:1 (1440*1440) - 高清正方形
3. 输入描述：一幅精美的中国风插画，工笔画风格，细节丰富
4. 点击生成
```

**输出：**
```
分辨率：1440*1440
质量：高品质
适合：专业设计、印刷物料
```

## 分辨率计算说明

### 万相2.5的分辨率验证

**总像素计算**：
```python
def validate_resolution_2_5(width, height):
    """验证万相2.5分辨率"""
    total_pixels = width * height
    min_pixels = 768 * 768  # 589,824
    max_pixels = 1440 * 1440  # 2,073,600
    
    if total_pixels < min_pixels or total_pixels > max_pixels:
        return False, "总像素超出范围"
    
    # 检查宽高比
    aspect_ratio = max(width, height) / min(width, height)
    if aspect_ratio > 4:
        return False, "宽高比超出[1:4, 4:1]范围"
    
    return True, "合法"
```

**示例计算**：
```
1280*1280：
  总像素 = 1,638,400
  宽高比 = 1:1
  结果：✅ 合法

1440*810：
  总像素 = 1,166,400
  宽高比 = 16:9 ≈ 1.78:1
  结果：✅ 合法

768*2700：
  总像素 = 2,073,600
  宽高比 ≈ 1:3.52
  结果：✅ 合法（在范围内）

1440*300：
  总像素 = 432,000
  宽高比 = 4.8:1
  结果：❌ 不合法（宽高比超出）
```

### 万相2.2的分辨率验证

**单边限制检查**：
```python
def validate_resolution_2_2(width, height):
    """验证万相2.2分辨率"""
    if width < 512 or width > 1440:
        return False, "宽度超出[512, 1440]范围"
    
    if height < 512 or height > 1440:
        return False, "高度超出[512, 1440]范围"
    
    return True, "合法"
```

**示例计算**：
```
1024*1024：
  宽度 = 1024 ✅
  高度 = 1024 ✅
  结果：✅ 合法

1440*810：
  宽度 = 1440 ✅
  高度 = 810 ✅
  结果：✅ 合法

768*2700：
  宽度 = 768 ✅
  高度 = 2700 ❌ 超出1440
  结果：❌ 不合法
```

## API调用差异

### 万相模型API

**请求示例**：
```bash
POST https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis
Header: X-DashScope-Async: enable

{
    "model": "wan2.5-t2i-preview",  # 万相模型
    "input": {
        "prompt": "用户描述"
    },
    "parameters": {
        "size": "1280*1280",  # 分辨率
        "n": 1,
        "prompt_extend": true,
        "watermark": false
    }
}
```

### 通义千问模型API

**请求示例**：
```bash
POST https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis
Header: X-DashScope-Async: enable

{
    "model": "qwen-image-plus",  # 通义千问模型
    "input": {
        "prompt": "用户描述"
    },
    "parameters": {
        "size": "1328*1328",  # 预设分辨率
        "n": 1,
        "prompt_extend": true,
        "watermark": false
    }
}
```

**区别**：
- 模型ID不同
- 分辨率约束不同
- 其他参数相同

## 升级总结

### ✅ 核心改进

1. **新增3个万相模型** - Preview/Flash/Plus
2. **智能分辨率配置** - 根据模型自动切换
3. **模型说明显示** - 清晰的约束提示
4. **星标推荐标识** - 突出推荐模型
5. **灵活配置系统** - 易于扩展新模型

### 📊 模型能力对比

| 能力 | 万相2.5 | 万相2.2系列 | 通义千问 |
|------|---------|-----------|---------|
| **分辨率灵活性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| **最大分辨率** | 1440² | 1440² | 1664*928 |
| **推荐程度** | 🌟🌟🌟 | 🌟🌟🌟 | ⭐⭐ |
| **使用场景** | 通用 | 通用 | 特定 |

### 🎯 用户价值

- ✅ **更多选择** - 5个模型满足不同需求
- ✅ **更灵活** - 万相2.5支持自定义宽高比
- ✅ **更直观** - 模型说明清晰明了
- ✅ **更智能** - 自动切换分辨率选项
- ✅ **更专业** - 推荐标识引导选择

---

**版本**: v1.8.0  
**更新日期**: 2025-12-12  
**升级内容**: 新增万相文生图模型  
**推荐使用**: 🌟 万相2.5 Preview

**万相模型，更强大的文生图体验！** 🎨✨
